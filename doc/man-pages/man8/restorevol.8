.rn '' }`
''' $RCSfile$$Revision$$Date$
'''
''' $Log$
'''
.de Sh
.br
.if t .Sp
.ne 5
.PP
\fB\\$1\fR
.PP
..
.de Sp
.if t .sp .5v
.if n .sp
..
.de Ip
.br
.ie \\n(.$>=3 .ne \\$3
.el .ne 3
.IP "\\$1" \\$2
..
.de Vb
.ft CW
.nf
.ne \\$1
..
.de Ve
.ft R

.fi
..
'''
'''
'''     Set up \*(-- to give an unbreakable dash;
'''     string Tr holds user defined translation string.
'''     Bell System Logo is used as a dummy character.
'''
.tr \(*W-|\(bv\*(Tr
.ie n \{\
.ds -- \(*W-
.ds PI pi
.if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\" diablo 12 pitch
.ds L" ""
.ds R" ""
'''   \*(M", \*(S", \*(N" and \*(T" are the equivalent of
'''   \*(L" and \*(R", except that they are used on ".xx" lines,
'''   such as .IP and .SH, which do another additional levels of
'''   double-quote interpretation
.ds M" """
.ds S" """
.ds N" """""
.ds T" """""
.ds L' '
.ds R' '
.ds M' '
.ds S' '
.ds N' '
.ds T' '
'br\}
.el\{\
.ds -- \(em\|
.tr \*(Tr
.ds L" ``
.ds R" ''
.ds M" ``
.ds S" ''
.ds N" ``
.ds T" ''
.ds L' `
.ds R' '
.ds M' `
.ds S' '
.ds N' `
.ds T' '
.ds PI \(*p
'br\}
.\"	If the F register is turned on, we'll generate
.\"	index entries out stderr for the following things:
.\"		TH	Title 
.\"		SH	Header
.\"		Sh	Subsection 
.\"		Ip	Item
.\"		X<>	Xref  (embedded
.\"	Of course, you have to process the output yourself
.\"	in some meaninful fashion.
.if \nF \{
.de IX
.tm Index:\\$1\t\\n%\t"\\$2"
..
.nr % 0
.rr F
.\}
.TH restorevol 8 "OpenAFS" "18/May/2009" "AFS Command Reference"
.UC
.if n .hy 0
.if n .na
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.de CQ          \" put $1 in typewriter font
.ft CW
'if n "\c
'if t \\&\\$1\c
'if n \\&\\$1\c
'if n \&"
\\&\\$2 \\$3 \\$4 \\$5 \\$6 \\$7
'.ft R
..
.\" @(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2
.	\" AM - accent mark definitions
.bd B 3
.	\" fudge factors for nroff and troff
.if n \{\
.	ds #H 0
.	ds #V .8m
.	ds #F .3m
.	ds #[ \f1
.	ds #] \fP
.\}
.if t \{\
.	ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.	ds #V .6m
.	ds #F 0
.	ds #[ \&
.	ds #] \&
.\}
.	\" simple accents for nroff and troff
.if n \{\
.	ds ' \&
.	ds ` \&
.	ds ^ \&
.	ds , \&
.	ds ~ ~
.	ds ? ?
.	ds ! !
.	ds /
.	ds q
.\}
.if t \{\
.	ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.	ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.	ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.	ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.	ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.	ds ? \s-2c\h'-\w'c'u*7/10'\u\h'\*(#H'\zi\d\s+2\h'\w'c'u*8/10'
.	ds ! \s-2\(or\s+2\h'-\w'\(or'u'\v'-.8m'.\v'.8m'
.	ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.	ds q o\h'-\w'o'u*8/10'\s-4\v'.4m'\z\(*i\v'-.4m'\s+4\h'\w'o'u*8/10'
.\}
.	\" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds v \\k:\h'-(\\n(.wu*9/10-\*(#H)'\v'-\*(#V'\*(#[\s-4v\s0\v'\*(#V'\h'|\\n:u'\*(#]
.ds _ \\k:\h'-(\\n(.wu*9/10-\*(#H+(\*(#F*2/3))'\v'-.4m'\z\(hy\v'.4m'\h'|\\n:u'
.ds . \\k:\h'-(\\n(.wu*8/10)'\v'\*(#V*4/10'\z.\v'-\*(#V*4/10'\h'|\\n:u'
.ds 3 \*(#[\v'.2m'\s-2\&3\s0\v'-.2m'\*(#]
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.ds oe o\h'-(\w'o'u*4/10)'e
.ds Oe O\h'-(\w'O'u*4/10)'E
.	\" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.	\" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.	ds : e
.	ds 8 ss
.	ds v \h'-1'\o'\(aa\(ga'
.	ds _ \h'-1'^
.	ds . \h'-1'.
.	ds 3 3
.	ds o a
.	ds d- d\h'-1'\(ga
.	ds D- D\h'-1'\(hy
.	ds th \o'bp'
.	ds Th \o'LP'
.	ds ae ae
.	ds Ae AE
.	ds oe oe
.	ds Oe OE
.\}
.rm #[ #] #H #V #F C
.SH "NAME"
restorevol \- Restore a volume from vos dump to the local file system
.SH "SYNOPSIS"
\fBrestorevol\fR <<\ [\fB\-file\fR\ <\fIdump\ file\fR] >>> <<\ [\fB\-dir\fR\ <\fIrestore\ dir\fR ] >>>
    <<\ [\fB\-extension\fR\ <\fIname\ extension\fR] >>>
    <<\ [\fB\-mountpoint\fR\ <\fImount\ point\ root\fR] >>>
    <<\ [\fB\-umask\fR\ <\fImode\ mask\fR] >>> [\fB\-verbose\fR] [\fB\-help\fR]
.SH "DESCRIPTION"
\fBrestorevol\fR takes an AFS volume in the format produced by \fBvos dump\fR
and restores it to the local file system.  Normally, the contents of a
volume are maintained by the AFS File Server in an opaque format and
copying a volume's raw data does not make it easily accessible.  This
utility will produce a directory tree that is equivalent to that seen via
an AFS client, but without preserving the AFS\-specific Access Control
Lists (ACLs).  It's primary use is to recover data from a volume dump or
backup and make it available via a filesystem other than AFS.
.PP
The dump output will read from standard input, or from a file if \fB\-file\fR
is specified.
.PP
The restore process is as follows:
.Ip "1. " 4
The dump file will be restored within the current directory or that
specified with \fB\-dir\fR.
.Ip "2. " 4
Within this directory, a subdir is created.  It's name is the \s-1RW\s0 volume
name that was dumped.  An extension can be appended to this directory name
with \fB\-extension\fR.
.Ip "3. " 4
All mountpoints will appear as symbolic links to the volume name.  The
path name to the volume will be either that in \fB\-mountpoint\fR, or \fB\-dir\fR.
Symbolic links remain untouched.
.Ip "4. " 4
You can change your umask during the restore with \fB\-umask\fR.  Otherwise,
\fBrestorevol\fR uses your current umask.  Mode bits for directories are 0777
(then \s-1AND\s0'ed with the umask).  Mode bits for files are the owner mode bits
duplicated accross group and user (then \s-1AND\s0'ed with the umask).
.Ip "5. " 4
For restores of full dumps, if a directory says it has a file and the file
is not found, then a symbolic link \fI< AFSFile-<#\fR >> will appear in that
restored tree.  Restores of incremental dumps remove all these files at
the end (expensive because it is a tree search).
.Ip "6. " 4
If a file or directory was found in the dump but found not to be connected
to the hierarchical tree, then the file or directory will be connected at
the root of the tree as \fI< _\|_ORPHANEDIR_\|_.<#\fR >> or \fI<
_\|_ORPHANFILE_\|_.<#\fR >>.
.Ip "7. " 4
ACLs are not restored.
.SH "CAUTIONS"
Normally, use the \fIvos_restore(1)\fR manpage instead of this command.  \fBrestorevol\fR is
a tool of last resort to try to extract data from the data structures
stored in a volume dumpfile and is not as regularly tested or used as the
normal the \fIvos_restore(1)\fR manpage implementation.  Using \fBrestorevol\fR bypasses
checks done by the the \fIfileserver(8)\fR manpage and the \fIsalvager(8)\fR manpage.
.SH "OPTIONS"
.Ip "\fB\-file\fR <\fIdump file\fR>" 4
Specifies the output file for the dump.  If this option is not given, the
volume will be dumped to standard output.
.Ip "\fB\-dir\fR <\fIrestore dir\fR>" 4
Names the directory in which to create the restored filesystem.  The
current directory is used by default.  Note that any mountpoints inside
the volume will point to the same directory unless the \fB\-mountpoint\fR
option is also specified.
.Ip "\fB\-extension\fR <\fIname extension\fR>" 4
By default, the name of the directory created matches the \s-1RW\s0 volume name
of the volume in the dump file.  If this option is used, the directory
name will be the \s-1RW\s0 volume name \fIname extension\fR as the suffix.
.Ip "\fB\-mountpoint\fR <\fImount point root\fR>" 4
By default, mountpoints inside the volume being restored point to the
value given by \fI\-dir\fR.  This option allows mountpoints to be resolved
relative to another path.  A common use for this would be to specify a
path under \fI/afs\fR as the mount point root so that mountpoints inside the
restored volume would be resolved via \s-1AFS\s0.
.Sp
The \fImount point root\fR must exist, and the process running the command
have read access to that directory, or the command will fail.
.SH "EXAMPLES"
The following command restores the contents of the dumpfile in
\fIsample.dump\fR to the directory \fI/tmp/sample.2009-05-17\fR, but having all
mountpoints inside the volume point to AFS (note that this requires
knowledge of where \fIsample\fR is mounted in AFS):
.PP
.Vb 3
\&   % restorevol -file sample.dump -dir /tmp -extension .2009-05-17 \e
\&       -mountpoint /afs/example.org/sample
\&   Restoring volume dump of 'sample' to directory '/tmp/sample.2009-05-17'
.Ve
.SH "PRIVILEGE REQUIRED"
The issuer must have read access to the dump file and write access to the
directory into which the dump is restored.  If the \fB\-mountpoint\fR flag is
given, the issuer must also have read access to that directory.
.SH "SEE ALSO"
the \fIsalvager(8)\fR manpage,
the \fIvoldump(8)\fR manpage,
the \fIvos_dump(1)\fR manpage,
the \fIvos_restore(1)\fR manpage
.SH "COPYRIGHT"
Copyright 2009 Steven Jenkins <steven@endpoint.com>
.PP
This documentation is covered by the BSD License as written in the
doc/LICENSE file. This man page was written by Steven Jenkins for
OpenAFS.

.rn }` ''
.IX Title "restorevol 8"
.IX Name "restorevol - Restore a volume from vos dump to the local file system"

.IX Header "NAME"

.IX Header "SYNOPSIS"

.IX Header "DESCRIPTION"

.IX Item "1. "

.IX Item "2. "

.IX Item "3. "

.IX Item "4. "

.IX Item "5. "

.IX Item "6. "

.IX Item "7. "

.IX Header "CAUTIONS"

.IX Header "OPTIONS"

.IX Item "\fB\-file\fR <\fIdump file\fR>"

.IX Item "\fB\-dir\fR <\fIrestore dir\fR>"

.IX Item "\fB\-extension\fR <\fIname extension\fR>"

.IX Item "\fB\-mountpoint\fR <\fImount point root\fR>"

.IX Header "EXAMPLES"

.IX Header "PRIVILEGE REQUIRED"

.IX Header "SEE ALSO"

.IX Header "COPYRIGHT"

