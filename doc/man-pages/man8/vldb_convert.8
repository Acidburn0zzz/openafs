.rn '' }`
''' $RCSfile$$Revision$$Date$
'''
''' $Log$
'''
.de Sh
.br
.if t .Sp
.ne 5
.PP
\fB\\$1\fR
.PP
..
.de Sp
.if t .sp .5v
.if n .sp
..
.de Ip
.br
.ie \\n(.$>=3 .ne \\$3
.el .ne 3
.IP "\\$1" \\$2
..
.de Vb
.ft CW
.nf
.ne \\$1
..
.de Ve
.ft R

.fi
..
'''
'''
'''     Set up \*(-- to give an unbreakable dash;
'''     string Tr holds user defined translation string.
'''     Bell System Logo is used as a dummy character.
'''
.tr \(*W-|\(bv\*(Tr
.ie n \{\
.ds -- \(*W-
.ds PI pi
.if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\" diablo 12 pitch
.ds L" ""
.ds R" ""
'''   \*(M", \*(S", \*(N" and \*(T" are the equivalent of
'''   \*(L" and \*(R", except that they are used on ".xx" lines,
'''   such as .IP and .SH, which do another additional levels of
'''   double-quote interpretation
.ds M" """
.ds S" """
.ds N" """""
.ds T" """""
.ds L' '
.ds R' '
.ds M' '
.ds S' '
.ds N' '
.ds T' '
'br\}
.el\{\
.ds -- \(em\|
.tr \*(Tr
.ds L" ``
.ds R" ''
.ds M" ``
.ds S" ''
.ds N" ``
.ds T" ''
.ds L' `
.ds R' '
.ds M' `
.ds S' '
.ds N' `
.ds T' '
.ds PI \(*p
'br\}
.\"	If the F register is turned on, we'll generate
.\"	index entries out stderr for the following things:
.\"		TH	Title 
.\"		SH	Header
.\"		Sh	Subsection 
.\"		Ip	Item
.\"		X<>	Xref  (embedded
.\"	Of course, you have to process the output yourself
.\"	in some meaninful fashion.
.if \nF \{
.de IX
.tm Index:\\$1\t\\n%\t"\\$2"
..
.nr % 0
.rr F
.\}
.TH vldb_convert 8 "OpenAFS" "27/Jun/2008" "AFS Command Reference"
.UC
.if n .hy 0
.if n .na
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.de CQ          \" put $1 in typewriter font
.ft CW
'if n "\c
'if t \\&\\$1\c
'if n \\&\\$1\c
'if n \&"
\\&\\$2 \\$3 \\$4 \\$5 \\$6 \\$7
'.ft R
..
.\" @(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2
.	\" AM - accent mark definitions
.bd B 3
.	\" fudge factors for nroff and troff
.if n \{\
.	ds #H 0
.	ds #V .8m
.	ds #F .3m
.	ds #[ \f1
.	ds #] \fP
.\}
.if t \{\
.	ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.	ds #V .6m
.	ds #F 0
.	ds #[ \&
.	ds #] \&
.\}
.	\" simple accents for nroff and troff
.if n \{\
.	ds ' \&
.	ds ` \&
.	ds ^ \&
.	ds , \&
.	ds ~ ~
.	ds ? ?
.	ds ! !
.	ds /
.	ds q
.\}
.if t \{\
.	ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.	ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.	ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.	ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.	ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.	ds ? \s-2c\h'-\w'c'u*7/10'\u\h'\*(#H'\zi\d\s+2\h'\w'c'u*8/10'
.	ds ! \s-2\(or\s+2\h'-\w'\(or'u'\v'-.8m'.\v'.8m'
.	ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.	ds q o\h'-\w'o'u*8/10'\s-4\v'.4m'\z\(*i\v'-.4m'\s+4\h'\w'o'u*8/10'
.\}
.	\" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds v \\k:\h'-(\\n(.wu*9/10-\*(#H)'\v'-\*(#V'\*(#[\s-4v\s0\v'\*(#V'\h'|\\n:u'\*(#]
.ds _ \\k:\h'-(\\n(.wu*9/10-\*(#H+(\*(#F*2/3))'\v'-.4m'\z\(hy\v'.4m'\h'|\\n:u'
.ds . \\k:\h'-(\\n(.wu*8/10)'\v'\*(#V*4/10'\z.\v'-\*(#V*4/10'\h'|\\n:u'
.ds 3 \*(#[\v'.2m'\s-2\&3\s0\v'-.2m'\*(#]
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.ds oe o\h'-(\w'o'u*4/10)'e
.ds Oe O\h'-(\w'O'u*4/10)'E
.	\" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.	\" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.	ds : e
.	ds 8 ss
.	ds v \h'-1'\o'\(aa\(ga'
.	ds _ \h'-1'^
.	ds . \h'-1'.
.	ds 3 3
.	ds o a
.	ds d- d\h'-1'\(ga
.	ds D- D\h'-1'\(hy
.	ds th \o'bp'
.	ds Th \o'LP'
.	ds ae ae
.	ds Ae AE
.	ds oe oe
.	ds Oe OE
.\}
.rm #[ #] #H #V #F C
.SH "NAME"
vldb_convert \- Convert the VLDB to/from Transarc AFS versions 3.1-3.4a
.SH "SYNOPSIS"
\fBvldb_convert\fR [\fBinitcmd\fR] <<\ [\fB\-to\fR]\ <\fIAFS\ version\ goal\fR >>>
    <<\ [\fB\-from\fR]\ <\fIcurrent\ AFS\ version\fR >>>
    <<\ [\fB\-path\fR]\ <\fIpath\ to\ VLDB\ file\fR >>> [\fB\-showversion\fR]
    [\fB\-dumpvldb\fR] [\fB\-help\fR]
.SH "DESCRIPTION"
The \fBvldb_convert\fR command is used to convert legacy Transarc 3.1-3.4
VLDB database files between versions. This command is not needed when
using OpenAFS except in the case of preparing to migrate a pre-3.4 version
of Transarc AFS to OpenAFS.
.PP
In order to convert the VLDB file, do the following:
.Ip "1." 4
Shutdown the \fBvlserver\fR process on all server machines. \fBvlserver\fR is
typically run only on the Cell servers, which must be listed in
\fICellServDB\fR or \s-1DNS\s0.
.Ip "2." 4
Backup the \s-1VLDB\s0 file \fI/usr/afs/db/vldb.\s-1DB0\s0\fR on the sync site to a safe
place. Typically, the sync site if the machine with the lowest \s-1IP\s0 address.
.Ip "3." 4
Remove the \fI/usr/afs/db/vldb.\s-1DBSYS1\s0\fR file from all cell server machines.
.Ip "4." 4
Remove the \fI/usr/afs/db/vldb.\s-1DB0\s0\fR file from the non-sync site server
machines.
.Ip "5." 4
Run the \fBvldb_convert\fR command on the \s-1VLDB\s0 file using the following
command:
.Sp
.Vb 1
\&   # vldb_convert -path /usr/afs/db/vldb.DB0
.Ve
.Ip "6." 4
Copy the new version of the vlserver binaries to all Cell servers.
.Ip "7." 4
Restart the vlserver process on all Cell servers. The new \s-1VLDB\s0 will be
distributed to all of the Cell servers.
.Ip "8." 4
Confirm that all Cell servers are synchronized and that the vldb looks in
good shape.
.SH "CAUTIONS"
Backup the VLDB file to a different directory or machine before performing
the upgrade. Be sure that all vlserver processes are always running the
same version. This requires downtime, but for this conversion, all
vlserver instances must be at the same version. This restriction is
relaxed in OpenAFS.
.SH "OPTIONS"
.Ip "[\fBinitcmd\fR]" 4
This is an optional string that does nothing.
.Ip "[\fB\-to\fR] <\fI\s-1AFS\s0 version goal\fR>" 4
This option is required when downgrading or when upgrading to a version
less than 3.4.  Specify 1, 2, 3, or 4 to choose version 3.1, 3.2, 3.3, or
3,4 respectively. This defaults to version 3.4.
.Ip "[\fB\-from\fR] <\fIcurrent \s-1AFS\s0 version\fR>" 4
This option is required when downgrading. Specify 1, 2, 3, or 4 to choose
version 3.1, 3.2, 3.3, or 3.4 respectively.
.Ip "[\fB\-path\fR] <\fIpath to \s-1VLDB\s0 file\fR>" 4
Specifies the path the \s-1VLDB\s0 file. This defaults to \fI/usr/afs/db/vldb.\s-1DB0\s0\fR
and only needs to be used if the \s-1VLDB\s0 file is not in the default path..
.Ip "\fB\-showversion\fR" 4
Shows the current version of the \s-1VLDB\s0. This option can only be used by itself.
.Ip "\fB\-dumpvldb\fR" 4
Produces verbose debugging output during the conversion process.
.Ip "\fB\-help\fR" 4
Prints the online help for this command. All other valid options are
ignored.
.SH "PRIVILEGE REQUIRED"
The issuer must have read and write access to the file
\fI/usr/afs/db/vldb.DB0\fR. This usually means that root access is required
on the cell server machines.
.SH "SEE ALSO"
the \fIvlserver(8)\fR manpage
.SH "COPYRIGHT"
Copyright 2008 Jason Edgecombe <jason@rampaginggeek.com>
.PP
This documentation is covered by the BSD License as written in the
doc/LICENSE file. This man page was written by Jason Edgecombe for
OpenAFS.

.rn }` ''
.IX Title "vldb_convert 8"
.IX Name "vldb_convert - Convert the VLDB to/from Transarc AFS versions 3.1-3.4a"

.IX Header "NAME"

.IX Header "SYNOPSIS"

.IX Header "DESCRIPTION"

.IX Item "1."

.IX Item "2."

.IX Item "3."

.IX Item "4."

.IX Item "5."

.IX Item "6."

.IX Item "7."

.IX Item "8."

.IX Header "CAUTIONS"

.IX Header "OPTIONS"

.IX Item "[\fBinitcmd\fR]"

.IX Item "[\fB\-to\fR] <\fI\s-1AFS\s0 version goal\fR>"

.IX Item "[\fB\-from\fR] <\fIcurrent \s-1AFS\s0 version\fR>"

.IX Item "[\fB\-path\fR] <\fIpath to \s-1VLDB\s0 file\fR>"

.IX Item "\fB\-showversion\fR"

.IX Item "\fB\-dumpvldb\fR"

.IX Item "\fB\-help\fR"

.IX Header "PRIVILEGE REQUIRED"

.IX Header "SEE ALSO"

.IX Header "COPYRIGHT"

