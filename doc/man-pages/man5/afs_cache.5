.rn '' }`
''' $RCSfile$$Revision$$Date$
'''
''' $Log$
'''
.de Sh
.br
.if t .Sp
.ne 5
.PP
\fB\\$1\fR
.PP
..
.de Sp
.if t .sp .5v
.if n .sp
..
.de Ip
.br
.ie \\n(.$>=3 .ne \\$3
.el .ne 3
.IP "\\$1" \\$2
..
.de Vb
.ft CW
.nf
.ne \\$1
..
.de Ve
.ft R

.fi
..
'''
'''
'''     Set up \*(-- to give an unbreakable dash;
'''     string Tr holds user defined translation string.
'''     Bell System Logo is used as a dummy character.
'''
.tr \(*W-|\(bv\*(Tr
.ie n \{\
.ds -- \(*W-
.ds PI pi
.if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\" diablo 12 pitch
.ds L" ""
.ds R" ""
'''   \*(M", \*(S", \*(N" and \*(T" are the equivalent of
'''   \*(L" and \*(R", except that they are used on ".xx" lines,
'''   such as .IP and .SH, which do another additional levels of
'''   double-quote interpretation
.ds M" """
.ds S" """
.ds N" """""
.ds T" """""
.ds L' '
.ds R' '
.ds M' '
.ds S' '
.ds N' '
.ds T' '
'br\}
.el\{\
.ds -- \(em\|
.tr \*(Tr
.ds L" ``
.ds R" ''
.ds M" ``
.ds S" ''
.ds N" ``
.ds T" ''
.ds L' `
.ds R' '
.ds M' `
.ds S' '
.ds N' `
.ds T' '
.ds PI \(*p
'br\}
.\"	If the F register is turned on, we'll generate
.\"	index entries out stderr for the following things:
.\"		TH	Title 
.\"		SH	Header
.\"		Sh	Subsection 
.\"		Ip	Item
.\"		X<>	Xref  (embedded
.\"	Of course, you have to process the output yourself
.\"	in some meaninful fashion.
.if \nF \{
.de IX
.tm Index:\\$1\t\\n%\t"\\$2"
..
.nr % 0
.rr F
.\}
.TH afs_cache 5 "OpenAFS" "5/Jan/2006" "AFS File Reference"
.UC
.if n .hy 0
.if n .na
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.de CQ          \" put $1 in typewriter font
.ft CW
'if n "\c
'if t \\&\\$1\c
'if n \\&\\$1\c
'if n \&"
\\&\\$2 \\$3 \\$4 \\$5 \\$6 \\$7
'.ft R
..
.\" @(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2
.	\" AM - accent mark definitions
.bd B 3
.	\" fudge factors for nroff and troff
.if n \{\
.	ds #H 0
.	ds #V .8m
.	ds #F .3m
.	ds #[ \f1
.	ds #] \fP
.\}
.if t \{\
.	ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.	ds #V .6m
.	ds #F 0
.	ds #[ \&
.	ds #] \&
.\}
.	\" simple accents for nroff and troff
.if n \{\
.	ds ' \&
.	ds ` \&
.	ds ^ \&
.	ds , \&
.	ds ~ ~
.	ds ? ?
.	ds ! !
.	ds /
.	ds q
.\}
.if t \{\
.	ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.	ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.	ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.	ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.	ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.	ds ? \s-2c\h'-\w'c'u*7/10'\u\h'\*(#H'\zi\d\s+2\h'\w'c'u*8/10'
.	ds ! \s-2\(or\s+2\h'-\w'\(or'u'\v'-.8m'.\v'.8m'
.	ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.	ds q o\h'-\w'o'u*8/10'\s-4\v'.4m'\z\(*i\v'-.4m'\s+4\h'\w'o'u*8/10'
.\}
.	\" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds v \\k:\h'-(\\n(.wu*9/10-\*(#H)'\v'-\*(#V'\*(#[\s-4v\s0\v'\*(#V'\h'|\\n:u'\*(#]
.ds _ \\k:\h'-(\\n(.wu*9/10-\*(#H+(\*(#F*2/3))'\v'-.4m'\z\(hy\v'.4m'\h'|\\n:u'
.ds . \\k:\h'-(\\n(.wu*8/10)'\v'\*(#V*4/10'\z.\v'-\*(#V*4/10'\h'|\\n:u'
.ds 3 \*(#[\v'.2m'\s-2\&3\s0\v'-.2m'\*(#]
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.ds oe o\h'-(\w'o'u*4/10)'e
.ds Oe O\h'-(\w'O'u*4/10)'E
.	\" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.	\" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.	ds : e
.	ds 8 ss
.	ds v \h'-1'\o'\(aa\(ga'
.	ds _ \h'-1'^
.	ds . \h'-1'.
.	ds 3 3
.	ds o a
.	ds d- d\h'-1'\(ga
.	ds D- D\h'-1'\(hy
.	ds th \o'bp'
.	ds Th \o'LP'
.	ds ae ae
.	ds Ae AE
.	ds oe oe
.	ds Oe OE
.\}
.rm #[ #] #H #V #F C
.SH "NAME"
afs_cache \- Format of data stored in an AFS client disk cache
.SH "DESCRIPTION"
The disk cache on a client machine is composed of multiple \fIV\fIn\fR\fR files
that contain the data, a \fICacheItems\fR file that records index information
for all of the \fIV\fIn\fR\fR files, and a \fIVolumeItems\fR file that records the
mapping between volume name and mount point for volumes.
.PP
When it initializes, the Cache Manager creates the cache files in the
configured cache location.  The standard directory name is
\fI/usr/vice/cache\fR, but it is acceptable to use a directory on a partition
with more available space. To designate a different directory, change the
value in the second field of the \fI/usr/vice/etc/cacheinfo\fR file before
issuing the \fBafsd\fR command, or include the \fB\-cachedir\fR argument to the
\fBafsd\fR command.
.Sh "\fICacheItems\fR"
The CacheItems file records information about each file in the disk cache
on a client machine (each \fIV\fIn\fR\fR file). The information includes the
file \s-1ID\s0 number and associated volume version number of the \s-1AFS\s0 file
currently stored in the \fBV\fR\fIn\fR file, which enables the Cache Manager to
determine which \fIV\fIn\fR\fR file contains the \s-1AFS\s0 data it needs to present to
an application.
.PP
As it initializes, the Cache Manager creates the binary-format
\fICacheItems\fR file in the same local disk cache directory as the \fIV\fIn\fR\fR
files that the \fICacheItems\fR file describes, and it must always remain
there.
.Sh "\fIVolumeItems\fR"
The \fIVolumeItems\fR file records the mapping between volume name and mount
point for each volume that the Cache Manager has accessed since it
initialized on a client machine using a disk cache. The Cache Manager uses
the mappings to respond correctly to queries about the current working
directory, which can come from the operating system or commands such as
the \s-1UNIX\s0 \fBpwd\fR command.
.PP
As it initializes, the Cache Manager creates the binary-format
\fIVolumeItems\fR file in the local disk cache directory, and it must always
remain there.
.Sh "\fIV\fIn\fR\fR"
A \fIV\fIn\fR\fR file can store a chunk of cached \s-1AFS\s0 data on a client machine
that is using a disk cache. As the Cache Manager initializes, it verifies
that the local disk cache directory houses a number of \fIV\fIn\fR\fR files
equal to the largest of the following:
.Ip "\(bu" 4
100
.Ip "\(bu" 4
One and a half times the result of dividing the cache size by the chunk
size (cachesize/chunksize * 1.5).
.Ip "\(bu" 4
The result of dividing the cache size by 10 \s-1MB\s0 (10,240).
.PP
The Cache Manager determines the cache size from the \fB\-blocks\fR argument
to the \fBafsd\fR command, or if the argument is not included, from the third
field of the \fI/usr/vice/etc/cacheinfo\fR file.  The default chunk size is
64 \s-1KB\s0; use the \fB\-chunksize\fR argument to the \fBafsd\fR command to override
it. To override the default number of chunks resulting from the
calculation, include the \fB\-files\fR argument to the \fBafsd\fR
command. the \fIafsd(8)\fR manpage describes the restrictions on acceptable values for
each of the arguments.
.PP
If the disk cache directory houses fewer \fIV\fIn\fR\fR files than necessary,
the Cache Manager creates new ones, assigning each a unique integer \fIn\fR
that distinguishes it from the other files; the integers start with 1 and
increment by one for each \fIV\fIn\fR\fR file created. The Cache Manager removes
files if there are more than necessary. The Cache Manager also adds and
removes \fIV\fIn\fR\fR files in response to the \fBfs setcachesize\fR command,
which can be used to alter the cache size between reboots.
.PP
\fIV\fIn\fR\fR files expand and contract to accommodate the size of the \s-1AFS\s0
directory listing or file they temporarily house. As mentioned, by default
each \fIV\fIn\fR\fR file holds up to 64 \s-1KB\s0 (65,536 bytes) of a cached \s-1AFS\s0
element. \s-1AFS\s0 elements larger than 64 \s-1KB\s0 are divided among multiple
\fBV\fR\fIn\fR files. If an element is smaller than 64 \s-1KB\s0, the \fIV\fIn\fR\fR file
expands only to the required size. A \fIV\fIn\fR\fR file accommodates only a
single element, so if there many small cached elements, it is possible to
exhaust the available \fIV\fIn\fR\fR files without reaching the maximum cache
size.
.SH "CAUTIONS"
Editing or removing the \fICacheItems\fR or \fIVolumeItems\fR files or a
\fIV\fIn\fR\fR file can cause a kernel panic. If the contents of \fIV\fIn\fR\fR files
seem out of date, clear the files by using the \fBfs flush\fR or \fBfs
flushvolume\fR command. If any of the cache files are accidentally modified
or deleted, rebooting the machine usually restores normal performance.
.PP
To alter cache size (and thus the number of \fIV\fIn\fR\fR files) between
reboots, use the \fBfs setcachesize\fR command. Alternatively, alter the
value of the \fB\-blocks\fR, \fB\-files\fR or \fB\-chunksize\fR arguments to the
\fBafsd\fR command invoked in the machine's AFS initialization file, and
reboot. To refresh the contents of one or more \fIV\fIn\fR\fR files, use the
\fBfs flush\fR or \fBfs flushvolume\fR command.
.SH "SEE ALSO"
the \fIcacheinfo(5)\fR manpage,
the \fIafsd(8)\fR manpage,
the \fIfs_checkvolumes(1)\fR manpage,
the \fIfs_flush(1)\fR manpage,
the \fIfs_flushvolume(1)\fR manpage,
the \fIfs_setcachesize(1)\fR manpage
.SH "COPYRIGHT"
IBM Corporation 2000. <http://www.ibm.com/> All Rights Reserved.
.PP
This documentation is covered by the IBM Public License Version 1.0.  It was
converted from HTML to POD by software written by Chas Williams and Russ
Allbery, based on work by Alf Wachsmann and Elizabeth Cassell.

.rn }` ''
.IX Title "afs_cache 5"
.IX Name "afs_cache - Format of data stored in an AFS client disk cache"

.IX Header "NAME"

.IX Header "DESCRIPTION"

.IX Subsection "\fICacheItems\fR"

.IX Subsection "\fIVolumeItems\fR"

.IX Subsection "\fIV\fIn\fR\fR"

.IX Item "\(bu"

.IX Item "\(bu"

.IX Item "\(bu"

.IX Header "CAUTIONS"

.IX Header "SEE ALSO"

.IX Header "COPYRIGHT"

