.rn '' }`
''' $RCSfile$$Revision$$Date$
'''
''' $Log$
'''
.de Sh
.br
.if t .Sp
.ne 5
.PP
\fB\\$1\fR
.PP
..
.de Sp
.if t .sp .5v
.if n .sp
..
.de Ip
.br
.ie \\n(.$>=3 .ne \\$3
.el .ne 3
.IP "\\$1" \\$2
..
.de Vb
.ft CW
.nf
.ne \\$1
..
.de Ve
.ft R

.fi
..
'''
'''
'''     Set up \*(-- to give an unbreakable dash;
'''     string Tr holds user defined translation string.
'''     Bell System Logo is used as a dummy character.
'''
.tr \(*W-|\(bv\*(Tr
.ie n \{\
.ds -- \(*W-
.ds PI pi
.if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\" diablo 12 pitch
.ds L" ""
.ds R" ""
'''   \*(M", \*(S", \*(N" and \*(T" are the equivalent of
'''   \*(L" and \*(R", except that they are used on ".xx" lines,
'''   such as .IP and .SH, which do another additional levels of
'''   double-quote interpretation
.ds M" """
.ds S" """
.ds N" """""
.ds T" """""
.ds L' '
.ds R' '
.ds M' '
.ds S' '
.ds N' '
.ds T' '
'br\}
.el\{\
.ds -- \(em\|
.tr \*(Tr
.ds L" ``
.ds R" ''
.ds M" ``
.ds S" ''
.ds N" ``
.ds T" ''
.ds L' `
.ds R' '
.ds M' `
.ds S' '
.ds N' `
.ds T' '
.ds PI \(*p
'br\}
.\"	If the F register is turned on, we'll generate
.\"	index entries out stderr for the following things:
.\"		TH	Title 
.\"		SH	Header
.\"		Sh	Subsection 
.\"		Ip	Item
.\"		X<>	Xref  (embedded
.\"	Of course, you have to process the output yourself
.\"	in some meaninful fashion.
.if \nF \{
.de IX
.tm Index:\\$1\t\\n%\t"\\$2"
..
.nr % 0
.rr F
.\}
.TH FS_CHECKSERVERS 1 "OpenAFS" "11/Nov/2007" "AFS Command Reference"
.UC
.if n .hy 0
.if n .na
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.de CQ          \" put $1 in typewriter font
.ft CW
'if n "\c
'if t \\&\\$1\c
'if n \\&\\$1\c
'if n \&"
\\&\\$2 \\$3 \\$4 \\$5 \\$6 \\$7
'.ft R
..
.\" @(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2
.	\" AM - accent mark definitions
.bd B 3
.	\" fudge factors for nroff and troff
.if n \{\
.	ds #H 0
.	ds #V .8m
.	ds #F .3m
.	ds #[ \f1
.	ds #] \fP
.\}
.if t \{\
.	ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.	ds #V .6m
.	ds #F 0
.	ds #[ \&
.	ds #] \&
.\}
.	\" simple accents for nroff and troff
.if n \{\
.	ds ' \&
.	ds ` \&
.	ds ^ \&
.	ds , \&
.	ds ~ ~
.	ds ? ?
.	ds ! !
.	ds /
.	ds q
.\}
.if t \{\
.	ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.	ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.	ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.	ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.	ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.	ds ? \s-2c\h'-\w'c'u*7/10'\u\h'\*(#H'\zi\d\s+2\h'\w'c'u*8/10'
.	ds ! \s-2\(or\s+2\h'-\w'\(or'u'\v'-.8m'.\v'.8m'
.	ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.	ds q o\h'-\w'o'u*8/10'\s-4\v'.4m'\z\(*i\v'-.4m'\s+4\h'\w'o'u*8/10'
.\}
.	\" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds v \\k:\h'-(\\n(.wu*9/10-\*(#H)'\v'-\*(#V'\*(#[\s-4v\s0\v'\*(#V'\h'|\\n:u'\*(#]
.ds _ \\k:\h'-(\\n(.wu*9/10-\*(#H+(\*(#F*2/3))'\v'-.4m'\z\(hy\v'.4m'\h'|\\n:u'
.ds . \\k:\h'-(\\n(.wu*8/10)'\v'\*(#V*4/10'\z.\v'-\*(#V*4/10'\h'|\\n:u'
.ds 3 \*(#[\v'.2m'\s-2\&3\s0\v'-.2m'\*(#]
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.ds oe o\h'-(\w'o'u*4/10)'e
.ds Oe O\h'-(\w'O'u*4/10)'E
.	\" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.	\" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.	ds : e
.	ds 8 ss
.	ds v \h'-1'\o'\(aa\(ga'
.	ds _ \h'-1'^
.	ds . \h'-1'.
.	ds 3 3
.	ds o a
.	ds d- d\h'-1'\(ga
.	ds D- D\h'-1'\(hy
.	ds th \o'bp'
.	ds Th \o'LP'
.	ds ae ae
.	ds Ae AE
.	ds oe oe
.	ds Oe OE
.\}
.rm #[ #] #H #V #F C
.SH "NAME"
fs_checkservers \- Displays the status of server machines
.SH "SYNOPSIS"
\fBfs checkservers\fR <<\ [\fB\-cell\fR\ <\fIcell\ to\ check\fR] >>> [\fB\-all\fR] [\fB\-fast\fR]
    <<\ [\fB\-interval\fR\ <\fIseconds\ between\ probes\fR] >>> [\fB\-help\fR]
.PP
\fBfs checks\fR <<\ [\fB\-c\fR\ <\fIcell\ to\ check\fR] >>> [\fB\-a\fR] [\fB\-f\fR]
    <<\ [\fB\-i\fR\ <\fIseconds\ between\ probes\fR] >>> [\fB\-h\fR]
.SH "DESCRIPTION"
The \fBfs checkservers\fR command reports whether certain AFS server machines
are accessible from the local client machine. The machines belong to one
of two classes, and the Cache Manager maintains a list of them in kernel
memory:
.Ip "\(bu" 4
The database server machines in every cell listed in the local
\fI/usr/vice/etc/CellServDB file\fR, plus any machines added to the memory
list by the \fBfs newcell\fR command since the last reboot.
.Ip "\(bu" 4
All file server machines the Cache Manager has recently contacted, and
which it probably needs to contact again soon. In most cases, the Cache
Manager holds a callback on a file or volume fetched from the machine.
.PP
If the Cache Manager is unable to contact the vlserver process on a
database server machine or the \fBfileserver\fR process on a file server
machine, it marks the machine as inaccessible. (Actually, if a file server
machine is multihomed, the Cache Manager attempts to contact all of the
machine's interfaces, and only marks the machine as down if the
\fBfileserver\fR fails to reply via any of them.) The Cache Manager then
periodically (by default, every three minutes) sends a probe to each
marked machine, to see if it is still inaccessible. If a previously
inaccessible machine responds, the Cache Manager marks it as accessible
and no longer sends the periodic probes to it.
.PP
The \fBfs checkservers\fR command updates the list of inaccessible machines
by having the Cache Manager probe a specified set of them:
.Ip "\(bu" 4
By default, only machines that are marked inaccessible and belong to the
local cell (the cell listed in the local \fI/usr/vice/etc/ThisCell\fR
file).
.Ip "\(bu" 4
If the \fB\-cell\fR argument is included, only machines that are marked
inaccessible and belong to the specified cell.
.Ip "\(bu" 4
If the \fB\-all\fR flag is included, all machines marked inaccessible.
.PP
If the \fB\-fast\fR flag is included, the Cache Manager does not probe any
machines, but instead reports the results of the most recent previous
probe.
.PP
To set the interval between probes rather than produce a list of
inaccessible machines, use the \fB\-interval\fR argument. The non-default
setting persists until the machine reboots; to preserve it across reboots,
put the appropriate \fBfs checkservers\fR command in the machine's \s-1AFS\s0
initialization files.
.SH "CAUTIONS"
The command can take quite a while to complete, if a number of machines do
not respond to the Cache Manager's probe. The Cache Manager probes
machines sequentially and waits a standard timeout period before marking
the machine as unresponsive, to allow for slow network communication. To
make the command shell prompt return quickly, put the command in the
background. It is harmless to interrupt the command by typing Ctrl-C or
another interrupt signal.
.PP
Note that the Cache Manager probes only server machines marked
inaccessible in its memory list. A server machine's absence from the
output does not necessarily mean that it is functioning, because it
possibly is not included in the memory list at all (if, for example, the
Cache Manager has not contacted it recently). For the same reason, the
output is likely to vary on different client machines.
.PP
Unlike most \fBfs\fR commands, the fs checkservers command does not refer to
the AFSCELL environment variable.
.SH "OPTIONS"
.Ip "\fB\-cell\fR <\fIcell to check\fR>" 4
Names each cell in which to probe server machines marked as
inaccessible. Provide the fully qualified domain name, or a shortened form
that disambiguates it from the other cells listed in the local
\fI/usr/vice/etc/CellServDB\fR file. Combine this argument with the \fB\-fast\fR
flag if desired, but not with the \fB\-all\fR flag. Omit both this argument
and the \fB\-all\fR flag to probe machines in the local cell only.
.Ip "\fB\-all\fR" 4
Probes all machines in the Cache Manager's memory list that are marked
inaccessible. Combine this argument with the \fB\-fast\fR flag if desired, but
not with the \fB\-cell\fR argument. Omit both this flag and the \fB\-cell\fR
argument to probe machines in the local cell only.
.Ip "\fB\-fast\fR" 4
Displays the Cache Manager's current list of machines that are
inaccessible, rather than sending new probes. The output can as old as the
current setting of the probe interval (by default three minutes, and
maximum ten minutes).
.Ip "\fB\-interval\fR <\fIseconds between probes\fR>" 4
Sets or reports the number of seconds between the Cache Manager's probes
to machines in the memory list that are marked inaccessible:
.Ip "\(bu" 8
To set the interval, specify a value from the range between 1 and \f(CW600\fR
(10 minutes); the default is \f(CW180\fR (three minutes). The issuer must be
logged in as the local superuser \f(CWroot\fR. The altered setting persists
until again changed with this command, or until the machine reboots, at
which time the setting returns to the default.
.Ip "\(bu" 8
Provide a value of \f(CW0\fR (zero) to display the current interval setting. No
privilege is required. Do not combine this argument with any other.
.Ip "\fB\-help\fR" 4
Prints the online help for this command. All other valid options are
ignored.
.SH "OUTPUT"
If there are no machines marked as inaccessible, or if all of them now
respond to the Cache Manager's probe, the output is:
.PP
.Vb 1
\&   All servers are running.
.Ve
Note that this message does not mean that all server machines in each
relevant cell are running. The output indicates the status of only those
machines that the Cache Manager probes.
.PP
If a machine fails to respond to the probe within the timeout period, the
output begins with the string
.PP
.Vb 1
\&   These servers unavailable due to network or server problems:
.Ve
and lists the hostname of each machine on its own line. The Cache Manager
stores machine records by Internet address, so the format of each hostname
(uppercase or lowercase letters, or an Internet address in dotted decimal
format) depends on how the local cell's name service translates it at the
time the command is issued. If a server machine is multihomed, the output
lists only one of its interfaces (usually, the currently most preferred
one).
.PP
If the \fB\-interval\fR argument is provided with a value between \f(CW1\fR and
\f(CW600\fR, there is no output. If the value is \f(CW0\fR, the output reports the
probe interval as follows:
.PP
.Vb 1
\&   The current down server probe interval is <interval> secs
.Ve
.SH "EXAMPLES"
The following command displays the Cache Manager's current list of
unresponsive machines in the local cell, rather than probing them
again. The output indicates that if there were any machines marked
inaccessible, they all responded to the previous probe.
.PP
.Vb 2
\&   % fs checkservers -fast
\&   All servers are running.
.Ve
The following example probes machines in the Cache Manager's memory list
that belong to the \f(CWstateu.edu\fR cell:
.PP
.Vb 2
\&   % fs checkservers -cell stateu.edu
\&   All servers are running.
.Ve
The following example probes all server machines in the Cache Manager's
memory list. It reports that two machines did not respond to the probe.
.PP
.Vb 3
\&   % fs checkservers -all
\&   These servers unavailable due to network or server problems:
\&   fs1.abc.com SV3.STATE.EDU.
.Ve
.SH "PRIVILEGE REQUIRED"
To set the probe interval, the issuer must be logged in as the local
superuser \f(CWroot\fR. Otherwise, no privilege is required.
.SH "SEE ALSO"
the \fICellServDB(5)\fR manpage,
the \fIThisCell(5)\fR manpage,
the \fIfs_newcell(1)\fR manpage
.SH "COPYRIGHT"
IBM Corporation 2000. <http://www.ibm.com/> All Rights Reserved.
.PP
This documentation is covered by the IBM Public License Version 1.0.  It was
converted from HTML to POD by software written by Chas Williams and Russ
Allbery, based on work by Alf Wachsmann and Elizabeth Cassell.

.rn }` ''
.IX Title "FS_CHECKSERVERS 1"
.IX Name "fs_checkservers - Displays the status of server machines"

.IX Header "NAME"

.IX Header "SYNOPSIS"

.IX Header "DESCRIPTION"

.IX Item "\(bu"

.IX Item "\(bu"

.IX Item "\(bu"

.IX Item "\(bu"

.IX Item "\(bu"

.IX Header "CAUTIONS"

.IX Header "OPTIONS"

.IX Item "\fB\-cell\fR <\fIcell to check\fR>"

.IX Item "\fB\-all\fR"

.IX Item "\fB\-fast\fR"

.IX Item "\fB\-interval\fR <\fIseconds between probes\fR>"

.IX Item "\(bu"

.IX Item "\(bu"

.IX Item "\fB\-help\fR"

.IX Header "OUTPUT"

.IX Header "EXAMPLES"

.IX Header "PRIVILEGE REQUIRED"

.IX Header "SEE ALSO"

.IX Header "COPYRIGHT"

