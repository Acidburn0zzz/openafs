.rn '' }`
''' $RCSfile$$Revision$$Date$
'''
''' $Log$
'''
.de Sh
.br
.if t .Sp
.ne 5
.PP
\fB\\$1\fR
.PP
..
.de Sp
.if t .sp .5v
.if n .sp
..
.de Ip
.br
.ie \\n(.$>=3 .ne \\$3
.el .ne 3
.IP "\\$1" \\$2
..
.de Vb
.ft CW
.nf
.ne \\$1
..
.de Ve
.ft R

.fi
..
'''
'''
'''     Set up \*(-- to give an unbreakable dash;
'''     string Tr holds user defined translation string.
'''     Bell System Logo is used as a dummy character.
'''
.tr \(*W-|\(bv\*(Tr
.ie n \{\
.ds -- \(*W-
.ds PI pi
.if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\" diablo 12 pitch
.ds L" ""
.ds R" ""
'''   \*(M", \*(S", \*(N" and \*(T" are the equivalent of
'''   \*(L" and \*(R", except that they are used on ".xx" lines,
'''   such as .IP and .SH, which do another additional levels of
'''   double-quote interpretation
.ds M" """
.ds S" """
.ds N" """""
.ds T" """""
.ds L' '
.ds R' '
.ds M' '
.ds S' '
.ds N' '
.ds T' '
'br\}
.el\{\
.ds -- \(em\|
.tr \*(Tr
.ds L" ``
.ds R" ''
.ds M" ``
.ds S" ''
.ds N" ``
.ds T" ''
.ds L' `
.ds R' '
.ds M' `
.ds S' '
.ds N' `
.ds T' '
.ds PI \(*p
'br\}
.\"	If the F register is turned on, we'll generate
.\"	index entries out stderr for the following things:
.\"		TH	Title 
.\"		SH	Header
.\"		Sh	Subsection 
.\"		Ip	Item
.\"		X<>	Xref  (embedded
.\"	Of course, you have to process the output yourself
.\"	in some meaninful fashion.
.if \nF \{
.de IX
.tm Index:\\$1\t\\n%\t"\\$2"
..
.nr % 0
.rr F
.\}
.TH KLOG.KRB5 1 "OpenAFS" "28/Jun/2008" "AFS Command Reference"
.UC
.if n .hy 0
.if n .na
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.de CQ          \" put $1 in typewriter font
.ft CW
'if n "\c
'if t \\&\\$1\c
'if n \\&\\$1\c
'if n \&"
\\&\\$2 \\$3 \\$4 \\$5 \\$6 \\$7
'.ft R
..
.\" @(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2
.	\" AM - accent mark definitions
.bd B 3
.	\" fudge factors for nroff and troff
.if n \{\
.	ds #H 0
.	ds #V .8m
.	ds #F .3m
.	ds #[ \f1
.	ds #] \fP
.\}
.if t \{\
.	ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.	ds #V .6m
.	ds #F 0
.	ds #[ \&
.	ds #] \&
.\}
.	\" simple accents for nroff and troff
.if n \{\
.	ds ' \&
.	ds ` \&
.	ds ^ \&
.	ds , \&
.	ds ~ ~
.	ds ? ?
.	ds ! !
.	ds /
.	ds q
.\}
.if t \{\
.	ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.	ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.	ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.	ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.	ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.	ds ? \s-2c\h'-\w'c'u*7/10'\u\h'\*(#H'\zi\d\s+2\h'\w'c'u*8/10'
.	ds ! \s-2\(or\s+2\h'-\w'\(or'u'\v'-.8m'.\v'.8m'
.	ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.	ds q o\h'-\w'o'u*8/10'\s-4\v'.4m'\z\(*i\v'-.4m'\s+4\h'\w'o'u*8/10'
.\}
.	\" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds v \\k:\h'-(\\n(.wu*9/10-\*(#H)'\v'-\*(#V'\*(#[\s-4v\s0\v'\*(#V'\h'|\\n:u'\*(#]
.ds _ \\k:\h'-(\\n(.wu*9/10-\*(#H+(\*(#F*2/3))'\v'-.4m'\z\(hy\v'.4m'\h'|\\n:u'
.ds . \\k:\h'-(\\n(.wu*8/10)'\v'\*(#V*4/10'\z.\v'-\*(#V*4/10'\h'|\\n:u'
.ds 3 \*(#[\v'.2m'\s-2\&3\s0\v'-.2m'\*(#]
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.ds oe o\h'-(\w'o'u*4/10)'e
.ds Oe O\h'-(\w'O'u*4/10)'E
.	\" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.	\" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.	ds : e
.	ds 8 ss
.	ds v \h'-1'\o'\(aa\(ga'
.	ds _ \h'-1'^
.	ds . \h'-1'.
.	ds 3 3
.	ds o a
.	ds d- d\h'-1'\(ga
.	ds D- D\h'-1'\(hy
.	ds th \o'bp'
.	ds Th \o'LP'
.	ds ae ae
.	ds Ae AE
.	ds oe oe
.	ds Oe OE
.\}
.rm #[ #] #H #V #F C
.SH "NAME"
klog.krb5 \- Authenticates to Kerberos and obtains a token
.SH "SYNOPSIS"
\fBklog.krb5\fR [\fB\-x\fR] <<\ [\fB\-principal\fR\ <\fIuser\ name\fR] >>>
    [\-password <\fIuser's password\fR>] <<\ [\fB\-cell\fR\ <\fIcell\ name\fR] >>>
    <<\ [\fB\-k\fR\ <\fIrealm\fR] >>> [\fB\-pipe\fR] [\fB\-silent\fR]
    <<\ [\fB\-lifetime\fR\ <\fIticket\ lifetime\ in\ hh[:mm[:ss]]\fR] >>>
    [\fB\-setpag\fR] [\fB\-tmp\fR] [\fB\-noprdb\fR] [\fB\-unwrap\fR] [\fB\-help\fR]
.PP
\fBklog.krb5\fR [\fB\-x\fR] <<\ [\fB\-pr\fR\ <\fIuser\ name\fR] >>>
    <<\ [\fB\-pa\fR\ <\fIuser's\ password\fR] >>>
    <<\ [\fB\-c\fR\ <\fIcell\ name\fR] >>>
    \fB<< [\fB\-k\fR <\fIrealm\fR\fR] >>> [\fB\-pi\fR] [\fB\-si\fR]
    <<\ [\fB\-l\fR\ <\fIticket\ lifetime\ in\ hh[:mm[:ss]]\fR] >>>
    [\fB\-se\fR] [\fB\-t\fR] [\fB\-n\fR] [\fB\-u\fR] [\fB\-h\fR]
.SH "DESCRIPTION"
The \fBklog.krb5\fR command obtains a Kerberos v5 ticket from a Kerberos
KDC and, from the ticket, an AFS token and then stores it in the Cache
Manager.  The Cache Manager keeps the token in kernel memory and uses it
when obtaining authenticated access to the AFS filespace.  This command
does not affect the issuer's identity (UNIX UID) on the local file system.
.PP
By default, the command interpreter obtains a token for the AFS user name
that matches the issuer's local user name.  To specify an alternate user,
include the \fB\-principal\fR argument.  The user named by the \fB\-principal\fR
argument does not have to appear in the local password file (the
\fI/etc/passwd\fR file or equivalent).
.PP
By default, the command interpreter obtains a token for the local cell, as
defined by the AFSCELL environment variable set in the command shell or by
the \fI/usr/vice/etc/ThisCell\fR file on the local machine.  To specify an
alternate cell, include the \fB\-cell\fR argument.  A user can have tokens in
multiple cells simultaneously, but only one token per cell per connection
to the client machine.  If the user's credential structure already
contains a token for the requested cell, the token resulting from this
command replaces it.
.PP
By default, the command interpreter obtains a Kerberos ticket for the
local realm.  To specify a different Kerberos realm, include the \fB\-k\fR
argument.  The Kerberos realm name need not match the AFS cell name.
\fBklog.krb5\fR will request a ticket for the principal \f(CWafs/\fIcell\fR\fR where
\fIcell\fR is the cell name for which the user is requesting tokens, falling
back on the principal \f(CWafs\fR if that principal does not work.
.PP
The lifetime of the token resulting from this command is the smallest of
the following:
.Ip "\(bu" 4
The lifetime specified by the issuer with the \fB\-lifetime\fR argument if
that argument was given.
.Ip "\(bu" 4
The maximum ticket lifetime recorded for the \f(CWafs/\fIcell\fR\fR principal in
thet Kerberos database.
.Ip "\(bu" 4
The maximum ticket lifetime recorded in the specified user's Kerberos
database entry.
.SH "CAUTIONS"
By default, this command does not create a new process authentication
group (PAG); see the description of the \fBpagsh\fR command to learn about
PAGs.  If a cell does not use an AFS\-modified login utility, users must
include \fB\-setpag\fR option to this command, or issue the \fBpagsh\fR command
before this one, to have their tokens stored in a credential structure
that is identified by PAG rather than by local UID.  Users should be aware
that \fB\-setpag\fR will not work on some systems, most notably recent Linux
systems, and using \fBpagsh\fR is preferrable and more reliable.
.PP
When a credential structure is identified by local UID, the potential
security exposure is that the local superuser \f(CWroot\fR can use the UNIX
\fBsu\fR command to assume any other identity and automatically inherit the
tokens associated with that UID.  Identifying the credential structure by
PAG makes it more difficult (but not impossible) for the local superuser
to obtain tokens of other users.
.PP
If the \fB\-password\fR argument is used, the specified password cannot begin
with a hyphen, because it is interpreted as another option name.  Use of
the \fB\-password\fR argument is not recommended in any case.
.PP
By default, it is possible to issue this command on a properly configured
NFS client machine that is accessing AFS via the NFS/AFS Translator,
assuming that the NFS client machine is a supported system type. However,
if the translator machine's administrator has enabled UID checking by
including the \fB\-uidcheck on\fR argument to the \fBfs exportafs\fR command, the
command fails with an error message similar to the following:
.PP
.Vb 2
\&   Warning: Remote pioctl to <translator_machine> has failed (err=8). . .
\&   Unable to authenticate to AFS because a pioctl failed.
.Ve
Enabling UID checking means that the credential structure in which tokens
are stored on the translator machine must be identified by a UID that
matches the local UID of the process that is placing the tokens in the
credential structure.  After the \fBklog.krb5\fR command interpreter obtains
the token on the NFS client, it passes it to the remote executor daemon on
the translator machine, which makes the system call that stores the token
in a credential structure on the translator machine.  The remote executor
generally runs as the local superuser \f(CWroot\fR, so in most cases its local
UID (normally zero) does not match the local UID of the user who issued
the \fBklog.krb5\fR command on the NFS client machine.
.PP
Issuing the \fBklog.krb5\fR command on an NFS client machine creates a
security exposure: the command interpreter passes the token across the
network to the remote executor daemon in clear text mode.
.SH "OPTIONS"
.Ip "\fB\-x\fR" 4
Appears only for backwards compatibility.  Its former function is now the
default behavior of this command.
.Ip "\fB\-principal\fR <\fIuser name\fR>" 4
Specifies the user name to authenticate.  If this argument is omitted, the
default value is the local user name.
.Ip "\fB\-password\fR <\fIuser's password\fR>" 4
Specifies the issuer's password (or that of the alternate user identified
by the \fB\-principal\fR argument).  Omit this argument to have the command
interpreter prompt for the password, in which case it does not echo
visibly in the command shell.
.Ip "\fB\-cell\fR <\fIcell name\fR>" 4
Specifies the cell for which to obtain a token.  During a single login
session on a given machine, a user can be authenticated in multiple cells
simultaneously, but can have only one token at a time for each of them
(that is, can only authenticate under one identity per cell per session on
a machine).  It is acceptable to abbreviate the cell name to the shortest
form that distinguishes it from the other cells listed in the
\fI/usr/vice/etc/CellServDB\fR file on the client machine on which the
command is issued.
.Sp
If this argument is omitted, the command is executed in the local cell, as
defined
.Ip "\(bu" 8
First, by the value of the environment variable \s-1AFSCELL\s0.
.Ip "\(bu" 8
Second, in the \fI/usr/vice/etc/ThisCell\fR file on the client machine on
which the command is issued.
.Ip "\fB\-k\fR <\fIrealm\fR>" 4
Obtain tickets and tokens from the <\fIrealm\fR> Kerberos realm.  If this
option is not given, \fBklog.krb5\fR defaults to using the default local
realm.  The Kerberos realm name need not match the \s-1AFS\s0 cell name.
.Ip "\fB\-pipe\fR" 4
Suppresses all output to the standard output stream, including prompts and
error messages. The \fBklog.krb5\fR command interpreter expects to receive
the password from the standard input stream. Do not use this argument; it
is designed for use by application programs rather than human users.
.Ip "\fB\-silent\fR" 4
Suppresses some of the trace messages that the \fBklog.krb5\fR command
produces on the standard output stream by default.  It still reports on
major problems encountered.
.Ip "\fB\-lifetime\fR <\fIticket lifetime\fR" 4
Requests a specific lifetime for the token.  Provide a number of hours and
optionally minutes and seconds in the format \fIhh\fR[\fB:\fR\fImm\fR[\fB:\fR\fIss\fR]].
.Ip "\fB\-setpag\fR" 4
Creates a process authentication group (\s-1PAG\s0) prior to requesting
authentication. The token is associated with the newly created \s-1PAG\s0.
.Ip "\fB\-tmp\fR" 4
Creates a Kerberos-style ticket file rather than only obtaining tokens.
The ticket file will be stored in the default Kerberos ticket cache
location, which is usually in the \fI/tmp\fR directory of the local machine
(but depends on the Kerberos implementation used).
.Ip "\fB\-noprdb\fR" 4
By default, \fBklog.krb5\fR looks up the user's \s-1AFS\s0 \s-1ID\s0 in the Protection
Server and associates the token with that \s-1AFS\s0 \s-1ID\s0.  This is helpful when
looking at the output of commands like \fBtokens\fR but is not required.  If
this option is given, this behavior is suppressed and \fBklog.krb5\fR will
store the token under a generic name.  You may wish this if, for example,
you have problems contacting the Protection Server for an \s-1AFS\s0 cell for
some reason.
.Ip "\fB\-unwrap\fR" 4
Normally, \fBklog.krb5\fR uses the Kerberos service ticket for the \s-1AFS\s0
principal as the \s-1AFS\s0 token.  If this option is given, \fBklog.krb5\fR creates
a different, simplified \s-1AFS\s0 token form based on the service ticket (the
so-called \*(L"rxkad 2b\*(R" token).  Normally, this is not necessary.  However,
if you are using older OpenAFS software that cannot handle large ticket
sizes in conjunction with Active Directory as the Kerberos server, using
\fB\-unwrap\fR can shrink the \s-1AFS\s0 token size so that older software can handle
it more easily.
.Ip "\fB\-help\fR" 4
Prints the online help for this command. All other valid options are
ignored.
.SH "OUTPUT"
If the \fB\-tmp\fR flag is included, the following message confirms that a
Kerberos ticket cache was created:
.PP
.Vb 1
\&   Wrote ticket file to /tmp/krb5cc_1000_rENJoZ
.Ve
The path to the cache will vary, of course.
.SH "EXAMPLES"
Most often, this command is issued without arguments. The appropriate
password is for the person currently logged into the local system.  The
ticket's lifetime is calculated as described in the \fIDESCRIPTION\fR manpage.
.PP
.Vb 2
\&   % klog.krb5
\&   Password for user@EXAMPLE.ORG:
.Ve
The following example authenticates the user as admin in the ABC
Corporation's test cell:
.PP
.Vb 2
\&   % klog.krb5 -principal admin -cell test.abc.com
\&   Password for admin@ABC.COM:
.Ve
In the following, the issuer requests a ticket lifetime of 104 hours 30
minutes (4 days 8 hours 30 minutes).
.PP
.Vb 2
\&   % klog.krb5 -lifetime 104:30
\&   Password for user@EXAMPLE.ORG:
.Ve
.SH "PRIVILEGE REQUIRED"
None
.SH "SEE ALSO"
the \fIaklog(1)\fR manpage,
the \fIfs_exportafs(1)\fR manpage,
the \fIpagsh(1)\fR manpage,
the \fItokens(1)\fR manpage
.SH "COPYRIGHT"
IBM Corporation 2000. <http://www.ibm.com/> All Rights Reserved.
.PP
This documentation is covered by the IBM Public License Version 1.0.  It
was converted from HTML to POD by software written by Chas Williams and
Russ Allbery, based on work by Alf Wachsmann and Elizabeth Cassell.

.rn }` ''
.IX Title "KLOG.KRB5 1"
.IX Name "klog.krb5 - Authenticates to Kerberos and obtains a token"

.IX Header "NAME"

.IX Header "SYNOPSIS"

.IX Header "DESCRIPTION"

.IX Item "\(bu"

.IX Item "\(bu"

.IX Item "\(bu"

.IX Header "CAUTIONS"

.IX Header "OPTIONS"

.IX Item "\fB\-x\fR"

.IX Item "\fB\-principal\fR <\fIuser name\fR>"

.IX Item "\fB\-password\fR <\fIuser's password\fR>"

.IX Item "\fB\-cell\fR <\fIcell name\fR>"

.IX Item "\(bu"

.IX Item "\(bu"

.IX Item "\fB\-k\fR <\fIrealm\fR>"

.IX Item "\fB\-pipe\fR"

.IX Item "\fB\-silent\fR"

.IX Item "\fB\-lifetime\fR <\fIticket lifetime\fR"

.IX Item "\fB\-setpag\fR"

.IX Item "\fB\-tmp\fR"

.IX Item "\fB\-noprdb\fR"

.IX Item "\fB\-unwrap\fR"

.IX Item "\fB\-help\fR"

.IX Header "OUTPUT"

.IX Header "EXAMPLES"

.IX Header "PRIVILEGE REQUIRED"

.IX Header "SEE ALSO"

.IX Header "COPYRIGHT"

